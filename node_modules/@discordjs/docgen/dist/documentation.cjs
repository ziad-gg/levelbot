"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const m=require("node:path"),d=require("./types/class.cjs"),h=require("./types/constructor.cjs"),p=require("./types/event.cjs"),b=require("./types/external.cjs"),k=require("./types/interface.cjs"),g=require("./types/member.cjs"),f=require("./types/method.cjs"),w=require("./types/typedef.cjs"),y=require("./package.cjs");class u{constructor(a,t,r){if(this.config=t,this.custom=r,this.classes=new Map,this.functions=new Map,this.interfaces=new Map,this.typedefs=new Map,this.externals=new Map,t.typescript){const e=a;for(const n of e)switch(n.kindString){case"Class":{this.classes.set(n.name,new d.DocumentedClass(n,t)),n.children&&this.parse(n.children,n);break}case"Function":{this.functions.set(n.name,new f.DocumentedMethod(n,t));break}case"Interface":case"Type alias":case"Enumeration":this.typedefs.set(n.name,new w.DocumentedTypeDef(n,t)),n.children&&this.parse(n.children,n);break}}else{let e=a;e=e.filter(n=>!n.ignore);for(const n of e)switch(n.kind){case"class":{this.classes.set(n.name,new d.DocumentedClass(n,t)),e=e.filter(s=>s.longname!==n.longname||s.kind!==n.kind);break}case"function":{(n.scope==="global"||!n.memberof)&&(this.functions.set(n.name,new f.DocumentedMethod(n,t)),e=e.filter(s=>s.longname!==n.longname));break}case"interface":{this.interfaces.set(n.name,new k.DocumentedInterface(n,t)),e=e.filter(s=>s.longname!==n.longname);break}case"typedef":{this.typedefs.set(n.name,new w.DocumentedTypeDef(n,t)),e=e.filter(s=>s.longname!==n.longname);break}case"external":{this.externals.set(n.name,new b.DocumentedExternal(n,t)),e=e.filter(s=>s.longname!==n.longname);break}}this.parse(e)}}parse(a,t){if(this.config.typescript){const r=a;for(const e of r){let n=null;switch(e.kindString){case"Constructor":{n=new h.DocumentedConstructor(e,this.config);break}case"Method":{if(t?.groups?.find(o=>o.title==="Events")?.children?.includes(e.id)){n=new p.DocumentedEvent(e,this.config);break}n=new f.DocumentedMethod(e,this.config);break}case"Property":{n=new g.DocumentedMember(e,this.config);break}default:console.warn(`- Unknown documentation kind "${e.kindString}" - 
${JSON.stringify(e)}
`)}const s=this.classes.get(t.name)??this.interfaces.get(t.name);if(s){n?s.add(n):console.warn(`- Documentation item could not be constructed for "${e.name}" - 
${JSON.stringify(e)}
`);continue}const i=[],l=(e.name||n?.data.name)??"UNKNOWN",c=e.kindString==="constructor"?null:{file:e.sources?.[0]?.fileName,line:e.sources?.[0]?.line,path:m.dirname(e.sources?.[0]?.fileName??"")};t.name&&i.push(`member of "${t.name}"`),c&&i.push(`${m.relative(this.config.root,m.join(c.path,c.file??""))}${c.line?`:${c.line}`:""}`),console.warn(`- "${l}"${i.length?` (${i.join(", ")})`:""} has no accessible parent.`),!l&&!i.length&&console.warn("Raw object:",e)}}else{const r=a;for(const e of r){let n=null;switch(e.kind){case"constructor":{n=new h.DocumentedConstructor(e,this.config);break}case"function":{n=new f.DocumentedMethod(e,this.config);break}case"member":{n=new g.DocumentedMember(e,this.config);break}case"event":{n=new p.DocumentedEvent(e,this.config);break}default:console.warn(`- Unknown documentation kind "${e.kind}" - 
${JSON.stringify(e)}
`)}const s=this.classes.get(e.memberof??"")??this.interfaces.get(e.memberof??"");if(s){n?s.add(n):console.warn(`- Documentation item could not be constructed for "${e.name}" - 
${JSON.stringify(e)}
`);continue}const i=[],l=(e.name||n?.data.name)??"UNKNOWN",c=e.memberof??n?.data?.memberof,o=e.kind==="constructor"?null:{file:e.meta.filename,line:e.meta.lineno,path:e.meta.path};c&&i.push(`member of "${c}"`),o&&i.push(`${m.relative(this.config.root,m.join(o.path,o.file))}${o.line?`:${o.line}`:""}`),console.warn(`- "${l}"${i.length?` (${i.join(", ")})`:""} has no accessible parent.`),!l&&!i.length&&console.warn("Raw object:",e)}}}serialize(){return{meta:{generator:y.version,format:u.FORMAT_VERSION,date:Date.now()},classes:[...this.classes.values()].map(a=>a.serialize()),functions:[...this.functions.values()].map(a=>a.serialize()),interfaces:[...this.interfaces.values()].map(a=>a.serialize()),typedefs:[...this.typedefs.values()].map(a=>a.serialize()),externals:[...this.externals.values()].map(a=>a.serialize()),custom:this.custom}}static get FORMAT_VERSION(){return 30}}exports.Documentation=u;
//# sourceMappingURL=documentation.cjs.map
